<!DOCTYPE html>
<html>
<head>
    <title>API Test - Portfolio Data</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow: auto; }
    </style>
</head>
<body>
    <h1>Portfolio API Test</h1>
    <button onclick="testAPI()">Test API</button>
    <div id="result"></div>

    <script>
        function testAPI() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Loading...</p>';

            fetch('api/portfolio.php')
            .then(response => {
                if (!response.ok) {
                    throw new Error('HTTP ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                console.log('API Response:', data);
                
                let html = '<div class="section success"><h2>✅ API Working!</h2></div>';
                
                // Test each section
                html += '<div class="section">';
                html += '<h3>Basic Information</h3>';
                html += '<p><strong>Name:</strong> ' + (data.basics?.name || 'Not found') + '</p>';
                html += '<p><strong>Email:</strong> ' + (data.basics?.email || 'Not found') + '</p>';
                html += '</div>';
                
                html += '<div class="section">';
                html += '<h3>Skills (' + (data.skills?.length || 0) + ' categories)</h3>';
                if (data.skills && data.skills.length > 0) {
                    data.skills.forEach(skill => {
                        html += '<p><strong>' + skill.situation + ':</strong> ' + (skill.keywords?.join(', ') || 'No keywords') + '</p>';
                    });
                } else {
                    html += '<p>No skills found</p>';
                }
                html += '</div>';
                
                html += '<div class="section">';
                html += '<h3>Projects (' + (data.repository?.length || 0) + ' projects)</h3>';
                if (data.repository && data.repository.length > 0) {
                    data.repository.forEach(project => {
                        html += '<p><strong>' + project.name + '</strong> (' + project.bestLang + ')</p>';
                    });
                } else {
                    html += '<p>No projects found</p>';
                }
                html += '</div>';
                
                html += '<div class="section">';
                html += '<h3>Work Experience (' + (data.work?.length || 0) + ' jobs)</h3>';
                if (data.work && data.work.length > 0) {
                    data.work.forEach(job => {
                        html += '<p><strong>' + job.position + '</strong> at ' + job.name + ' (' + job.startDate + ' - ' + job.endDate + ')</p>';
                    });
                } else {
                    html += '<p>No work experience found</p>';
                }
                html += '</div>';
                
                html += '<div class="section">';
                html += '<h3>Education (' + (data.education?.length || 0) + ' institutions)</h3>';
                if (data.education && data.education.length > 0) {
                    data.education.forEach(edu => {
                        html += '<p><strong>' + edu.institution + '</strong> - ' + edu.studyType + ' in ' + edu.area + '</p>';
                    });
                } else {
                    html += '<p>No education found</p>';
                }
                html += '</div>';
                
                html += '<div class="section">';
                html += '<h3>Raw API Response:</h3>';
                html += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                html += '</div>';
                
                resultDiv.innerHTML = html;
            })
            .catch(error => {
                console.error('API Error:', error);
                resultDiv.innerHTML = '<div class="section error"><h2>❌ API Error</h2><p>' + error.message + '</p></div>';
            });
        }

        // Auto-test on page load
        window.onload = function() {
            testAPI();
        };
    </script>
</body>
</html>
